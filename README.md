**RenderHouse — MVP**

一键把草图 / 平面图 / 立面图 / 现场照片生成逼真房屋渲染。

- **目标**：用户上传草图/平面/立面/照片，快速拿到逼真的房屋渲染图，用于沟通和初步决策。  
- **用户能做什么**  
  - 上传：JPG/PNG，建议 ≥800px，≤10MB；可是一张草图、平面/立面、或房屋照片。  
  - 可选参数：风格（现代/北欧/美式等）、光线（白天/黄昏/夜景）。  
  - 一键生成 2–4 张逼真渲染，展示不同角度或构图。  
  - 预览并下载 PNG/JPG；不满意可立即再生成一组。  

- **交互流程（MVP）**  
  1) 登录后点击“新建渲染”。  
  2) 拖拽/选择图片上传，通过校验后继续。  
  3) （可选）选择风格与光线；不选则使用默认。  
  4) 点击“生成”，等待进度；完成后展示多张结果。  
  5) 选择并下载需要的渲染图；可点击“再来一组”。  

- **输入规范**  
  - 格式：JPG、PNG  
  - 大小：≤10MB，推荐 ≥800px 边长  
  - 内容：单张草图/平面/立面/照片（暂不支持多张拼合或批量上传）  

- **输出规范**  
  - 默认导出：PNG/JPG，约 2K 边长  
  - 数量：默认 2–4 张（后续可调整）  

- **暂不涵盖（本阶段不做）**  
  - 计费/订阅、隐私开关  
  - 团队协作、批量处理  
  - VR/视频、8K 导出等高级功能  

---

## 页面结构（结合竞品观察，聚焦 MVP）

**Landing 首屏（不放素材轮播，后续再补）**
```
┌──────────────────────────────────────────┐
│ Nav: Logo         (空位)         Log in  │
├──────────────────────────────────────────┤
│                Hero 背景图               │
│   [How will your project look like?]     │
│   [副标题：AI photorealistic render...]  │
│   ┌────────────────────────────────┐     │
│   │  Upload your drawing [⬆️]      │     │
│   │  PNG/JPG/JPEG                  │     │
│   └────────────────────────────────┘     │
│   (可选风格/光线选项行，默认收起)         │
└──────────────────────────────────────────┘
```

**Dashboard（项目列表）**
```
┌──────────────────────────────────────────┐
│ ☰ Projects | New Project [+] | Free: 2 left │ avatar │
├──────────────────────────────────────────┤
│ Project Card 1   Project Card 2   ...    │
│ (封面 + 时间)                           │
└──────────────────────────────────────────┘
```

**Workspace（单项目渲染页）**
```
┌────────────────────────────────────────────────────────────┐
│ ← Projects  | 文件名 | Actions: Improve | Regenerate | DL  │
├────────────────────────────────────────────────────────────┤
│ Chat/Log Panel (左)   │  Render Canvas (右，大图)          │
│ - 生成记录卡片        │  - 当前最佳渲染图                   │
│ - “再来一组”按钮      │  - 轻量对比/撤销/重做（可选）       │
│ - 反馈输入框          │                                    │
└────────────────────────────────────────────────────────────┘
```

说明：保持按钮数量精简（上传/生成/再生成/下载），其他高级功能先不露出。首屏暂不展示素材轮播，仅留上传 CTA 与主视觉，后续再补素材。

## 渲染设置侧栏（借鉴竞品）
- 触发：Workspace 内“Render Settings”按钮，打开右侧抽屉；不跳页。  
- 顺序：Location → Lighting → Camera → 输出尺寸（可选）。  
- Location：单行按钮“Choose location”，可跳过，默认自动。  
- Lighting：六个彩色预设卡片（Sunrise/Morning/Noon/Afternoon/Sunset/Night），单选，默认 Noon。  
- Camera：默认“Maintain angle”；可提供“Auto best angle”开关。  
- More details：一个多行输入框（可折叠），供用户补充材质/氛围/环境要求；不必填写。  
- 设计原则：少选项、默认好、随时关闭；不强制填写；卡片式选项一眼可点。  

## Implementation Plan (Fal.ai Seedream v4 edit, latest-only)

- **模型**：接入 fal.ai `bytedance/seedream/v4/edit`，简化为单一推理调用（订阅/同步拿结果即可，先不做异步队列）。
- **对话即操作**：左侧纯聊天，无额外按钮。进入工作台时用户已上传原始图（`inputUrl`）；首条消息用文字给出风格/光线需求生成首版，后续直接自然语言追加修改，模型决定是否再次生成。
- **工具极简**：仅一个工具 `generate_render(current_image, prompt, style?, lighting?, strength?)`，由 Grok‑4.1-fast 触发；始终以“当前最新渲染图”作为输入，生成后覆盖旧版。`strength` 映射 Seedream 的参考强度。
- **展示策略**：右侧只展示“最新一版”；不做历史回退。
- **存储策略**：仅保留原始上传 + 最新渲染；新渲染成功后覆盖 DB `outputUrls`，并删除旧渲染文件，失败则保持旧版。
- **状态流转**：`uploaded → rendering → done/failed`；失败提示错误但不覆盖。
- **扩展口**：未来若要版本/异步/多模型，再增加工具与历史策略。

### API 对齐
- fal 模型：`https://fal.ai/models/fal-ai/bytedance/seedream/v4/edit/api`，核心入参 `prompt`、`image_url`、可选 `strength`、`image_size`、`num_inference_steps`、`output_format`；出参 `images[0].url` 为渲染结果。
- 大模型：OpenRouter `https://openrouter.ai/x-ai/grok-4.1-fast/api` 作为对话模型，持有对话上下文并在需要时调用 `generate_render` 工具。

### 密钥
- `FAL_API_KEY`、`OPENROUTER_API_KEY` 已放置于 `.env` 供后端调用（仅服务器使用，不暴露前端）。
